{
    "stages": {
        "mk_build_dir": "common:mkdirs",
        "synth": "common:synth",
        "prepare_sdc": "common:generic_script_wrapper",
        "pack": "common:pack",
        "ioplace": "common:generic_script_wrapper",
        "place_constraints": "common:generic_script_wrapper",
        "iomux_jlink": "common:generic_script_wrapper",
        "iomux_openocd": "common:generic_script_wrapper",
        "iomux_binary": "common:generic_script_wrapper",
        "place": "common:place",
        "route": "common:route",
        "analysis": "common:analysis",
        "fasm": "common:fasm",
        "bitstream": "common:generic_script_wrapper",
        "bitstream_bitheader": "common:generic_script_wrapper",
        "bitstream_binary": "common:generic_script_wrapper",
        "bitstream_jlink": "common:generic_script_wrapper",
        "bitstream_openocd": "common:generic_script_wrapper"
    },

    "values": {
        "device": "ql-eos-s3",
        "device_alt": "ql-eos-s3_wlcsp",
        "pinmap": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
        "arch_def": "${shareDir}/arch/ql-eos-s3_wlcsp/arch.timing.xml",
        "rr_graph_lookahead_bin": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.lookahead.bin",
        "rr_graph_real_bin": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.rr_graph.real.bin",
        "vpr_place_delay": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.place_delay.bin",
        "vpr_grid_layout_name": "ql-eos-s3",
        "vpr_options": {
            "max_router_iterations": 500,
            "routing_failure_predictor": "off",
            "router_high_fanout_threshold": -1,
            "constant_net_method": "route",
            "route_chan_width": 100,
            "clock_modeling": "route",
            "place_delay_model": "delta_override",
            "router_lookahead": "extended_map",
            "check_route": "quick",
            "strict_checks": "off",
            "allow_dangling_combinational_nodes": "on",
            "disable_errors": "check_unbuffered_edges:check_route",
            "congested_routing_iteration_threshold": "0.8",
            "incremental_reroute_delay_ripup": "off",
            "base_cost_type": "delay_normalized_length_bounded",
            "bb_factor": "10",
            "initial_pres_fac": "4.0",
            "check_rr_graph": "off",
            "pack_high_fanout_threshold": "PB-lOGIC:18",
            "suppress_warnings": "${noisyWarnings},sum_pin_class:check_unbuffered_edges:load_rr_indexed_data_T_values:check_rr_node:trans_per_R:check_route:set_rr_graph_tool_comment "
        }
    },

    "stage_options": {
        "mk_build_dir": {
            "params": {
                "build_dir": "build/${device}"
            }
        },
        "synth": {
            "params": {
                "takes": [ "pcf?" ],
                "produces": [
                    "synth_v"
                ]
            },
            "values": {
                "tcl_scripts": "${shareDir}/scripts/pp3",
                "read_verilog_args": [],
                "yosys_tcl_env": {
                    "OUT_JSON": "${:json}",
                    "OUT_SYNTH_V": "${:synth_v}",
                    "OUT_EBLIF": "${:eblif}",
                    "OUT_FASM_EXTRA": "${:fasm_extra}",
                    "TECHMAP_PATH": "${shareDir}/techmaps/pp3",
                    "DEVICE_CELLS_SIM": "${shareDir}/arch/ql-eos-s3_wlcsp/cells/ram_sim.v",
                    "DEVICE_CELLS_MAP": "${shareDir}/arch/ql-eos-s3_wlcsp/cells/ram_map.v",
                    "PINMAP_FILE": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
                    "PCF_FILE": "${:pcf}",
                    "PYTHON3": "${python3}",
                    "UTILS_PATH": "${binDir}/python"
                }
            }
        },
        "prepare_sdc": {
            "params": {
                "stage_name": "prepare_sdc",
                "interpreter": "${python3}",
                "script": "${binDir}/python/process_sdc_constraints.py",
                "outputs": {
                    "sdc": {
                        "mode": "file",
                        "file": "${:eblif[noext]}.sdc",
                        "target": "${:eblif[noext]}.sdc"
                    }
                },
                "inputs": {
                    "eblif": "${:eblif}",
                    "sdc-in": "${:sdc-in}",
                    "sdc-out": "${:eblif[noext]}.sdc",
                    "pcf": "${:pcf}",
                    "pin-map": "",
                    "$PYTHONPATH": "${binDir}/python/"
                }
            }
        },
        "pack": {
            "values": {
                "device": "ql-eos-s3",
                "device_alt": "ql-eos-s3_wlcsp",
                "pinmap": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
                "arch_def": "${shareDir}/arch/ql-eos-s3_wlcsp/arch.timing.xml",
                "rr_graph_lookahead_bin": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.lookahead.bin",
                "rr_graph_real_bin": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.rr_graph.real.bin",
                "vpr_place_delay": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.place_delay.bin",
                "vpr_grid_layout_name": "ql-eos-s3",
                "vpr_options": {
                    "write_block_usage": "block_usage.json",
                    "max_router_iterations": 500,
                    "routing_failure_predictor": "off",
                    "router_high_fanout_threshold": -1,
                    "constant_net_method": "route",
                    "route_chan_width": 100,
                    "clock_modeling": "route",
                    "place_delay_model": "delta_override",
                    "router_lookahead": "extended_map",
                    "check_route": "quick",
                    "strict_checks": "off",
                    "allow_dangling_combinational_nodes": "on",
                    "disable_errors": "check_unbuffered_edges:check_route",
                    "congested_routing_iteration_threshold": "0.8",
                    "incremental_reroute_delay_ripup": "off",
                    "base_cost_type": "delay_normalized_length_bounded",
                    "bb_factor": "10",
                    "initial_pres_fac": "4.0",
                    "check_rr_graph": "off",
                    "pack_high_fanout_threshold": "PB-lOGIC:18",
                    "suppress_warnings": "${noisyWarnings},sum_pin_class:check_unbuffered_edges:load_rr_indexed_data_T_values:check_rr_node:trans_per_R:check_route:set_rr_graph_tool_comment "
                }
            }
        },
        "ioplace": {
            "params": {
                "stage_name": "ioplace",
                "interpreter": "${python3}",
                "script": "${binDir}/python/pp3_create_ioplace.py",
                "outputs": {
                    "io_place": {
                        "mode": "stdout",
                        "target": "${:eblif[noext]}.ioplace"
                    }
                },
                "inputs": {
                    "blif": "${:eblif}",
                    "net": "${:net}",
                    "pcf": "${:pcf}",
                    "map": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
                    "$PYTHONPATH": "${binDir}/python/"
                }
            }
        },
        "place_constraints": {
            "params": {
                "stage_name": "place_constraints",
                "interpreter": "${python3}",
                "script": "${binDir}/python/pp3_create_place_constraints.py",
                "outputs": {
                    "place_constraints": {
                        "mode": "stdout",
                        "target": "${:eblif[noext]}_constraints.place"
                    }
                },
                "inputs": {
                    "blif": "${:eblif}",
                    "map": "${shareDir}/arch/ql-eos-s3_wlcsp/clkmap_PD64.csv",
                    "i": "${:io_place}",
                    "$PYTHONPATH": "${binDir}/python/"
                }
            }
        },
        "iomux_jlink": {
            "params": {
                "stage_name": "iomux_jlink",
                "interpreter": "${python3}",
                "script": "${binDir}/python/pp3_eos_s3_iomux_config.py",
                "outputs": {
                    "iomux_jlink": {
                        "mode": "stdout",
                        "target": "${:eblif[noext]}_iomux.jlink"
                    }
                },
                "inputs": {
                    "eblif": "${:eblif}",
                    "pcf": "${:pcf}",
                    "map": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
                    "output-format": "jlink",
                    "$PYTHONPATH": "${binDir}/python/"
                }
            }
        },
        "iomux_openocd": {
            "params": {
                "stage_name": "iomux_openocd",
                "interpreter": "${python3}",
                "script": "${binDir}/python/pp3_eos_s3_iomux_config.py",
                "outputs": {
                    "iomux_openocd": {
                        "mode": "stdout",
                        "target": "${:eblif[noext]}_iomux.openocd"
                    }
                },
                "inputs": {
                    "eblif": "${:eblif}",
                    "pcf": "${:pcf}",
                    "map": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
                    "output-format": "openocd",
                    "$PYTHONPATH": "${binDir}/python/"
                }
            }
        },
        "iomux_binary": {
            "params": {
                "stage_name": "iomux_binary",
                "interpreter": "${python3}",
                "script": "${binDir}/python/pp3_eos_s3_iomux_config.py",
                "outputs": {
                    "iomux_binary": {
                        "mode": "stdout",
                        "target": "${:eblif[noext]}_iomux.bin"
                    }
                },
                "inputs": {
                    "eblif": "${:eblif}",
                    "pcf": "${:pcf}",
                    "map": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
                    "output-format": "binary",
                    "$PYTHONPATH": "${binDir}/python/"
                }
            }
        },
        "route": {
            "values": {
                "device": "ql-eos-s3",
                "device_alt": "ql-eos-s3_wlcsp",
                "pinmap": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
                "arch_def": "${shareDir}/arch/ql-eos-s3_wlcsp/arch.timing.xml",
                "rr_graph_lookahead_bin": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.lookahead.bin",
                "rr_graph_real_bin": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.rr_graph.real.bin",
                "vpr_place_delay": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.place_delay.bin",
                "vpr_grid_layout_name": "ql-eos-s3",
                "vpr_options": {
                    "write_timing_summary": "timing_summary.json",
                    "max_router_iterations": 500,
                    "routing_failure_predictor": "off",
                    "router_high_fanout_threshold": -1,
                    "constant_net_method": "route",
                    "route_chan_width": 100,
                    "clock_modeling": "route",
                    "place_delay_model": "delta_override",
                    "router_lookahead": "extended_map",
                    "check_route": "quick",
                    "strict_checks": "off",
                    "allow_dangling_combinational_nodes": "on",
                    "disable_errors": "check_unbuffered_edges:check_route",
                    "congested_routing_iteration_threshold": "0.8",
                    "incremental_reroute_delay_ripup": "off",
                    "base_cost_type": "delay_normalized_length_bounded",
                    "bb_factor": "10",
                    "initial_pres_fac": "4.0",
                    "check_rr_graph": "off",
                    "pack_high_fanout_threshold": "PB-lOGIC:18",
                    "suppress_warnings": "${noisyWarnings},sum_pin_class:check_unbuffered_edges:load_rr_indexed_data_T_values:check_rr_node:trans_per_R:check_route:set_rr_graph_tool_comment "
                }
            }
        },
        "analysis": {
            "values": {
                "device": "ql-eos-s3",
                "device_alt": "ql-eos-s3_wlcsp",
                "pinmap": "${shareDir}/arch/ql-eos-s3_wlcsp/pinmap_PD64.csv",
                "arch_def": "${shareDir}/arch/ql-eos-s3_wlcsp/arch.timing.xml",
                "rr_graph_lookahead_bin": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.lookahead.bin",
                "rr_graph_real_bin": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.rr_graph.real.bin",
                "vpr_place_delay": "${shareDir}/arch/ql-eos-s3_wlcsp/rr_graph_ql-eos-s3_wlcsp.place_delay.bin",
                "vpr_grid_layout_name": "ql-eos-s3",
                "vpr_options": {
                    "gen_post_synthesis_netlist": "on",
                    "gen_post_implementation_merged_netlist": "on",
                    "post_synth_netlist_unconn_inputs": "nets",
                    "post_synth_netlist_unconn_outputs": "nets",
                    "verify_file_digests": "off",
                    "max_router_iterations": 500,
                    "routing_failure_predictor": "off",
                    "router_high_fanout_threshold": -1,
                    "constant_net_method": "route",
                    "route_chan_width": 100,
                    "clock_modeling": "route",
                    "place_delay_model": "delta_override",
                    "router_lookahead": "extended_map",
                    "check_route": "quick",
                    "strict_checks": "off",
                    "allow_dangling_combinational_nodes": "on",
                    "disable_errors": "check_unbuffered_edges:check_route",
                    "congested_routing_iteration_threshold": "0.8",
                    "incremental_reroute_delay_ripup": "off",
                    "base_cost_type": "delay_normalized_length_bounded",
                    "bb_factor": "10",
                    "initial_pres_fac": "4.0",
                    "check_rr_graph": "off",
                    "pack_high_fanout_threshold": "PB-lOGIC:18",
                    "suppress_warnings": "${noisyWarnings},sum_pin_class:check_unbuffered_edges:load_rr_indexed_data_T_values:check_rr_node:trans_per_R:check_route:set_rr_graph_tool_comment "
                }
            }
        },
        "bitstream": {
            "params": {
                "stage_name": "bitstream",
                "script": "qlfasm",
                "outputs": {
                    "bitstream": {
                        "mode": "file",
                        "file": "${:eblif[noext]}.bit",
                        "target": "${:eblif[noext]}.bit"
                    },
                    "bitstream_log": {
                        "mode": "stdout",
                        "target": "${:eblif[noext]}.bit.log"
                    }
                },
                "inputs": {
                    "#1": "${:fasm}",
                    "#2": "${:eblif[noext]}.bit",
                    "dev-type": "ql-eos-s3"
                }
            },
            "values": {
                "build_dir": "."
            }
        },
        "bitstream_bitheader": {
            "params": {
                "stage_name": "bitstream_bitheader",
                "script": "symbiflow_write_bitheader",
                "outputs": {
                    "bitstream_bitheader": {
                        "mode": "file",
                        "file": "${:bitstream}.h",
                        "target": "${:bitstream}.h"
                    },
                    "bitstream_bitheader_log": {
                        "mode": "stdout",
                        "target": "${:bitstream}.h.log"
                    }
                },
                "inputs": {
                    "#1": "${:bitstream}",
                    "#2": "${:bitstream}.h",
                    "#3": "${:iomux_binary}"
                }
            }
        },
        "bitstream_jlink": {
            "params": {
                "stage_name": "bitstream_jlink",
                "script": "symbiflow_write_jlink",
                "outputs": {
                    "bitstream_jlink": {
                        "mode": "file",
                        "file": "${:bitstream}.jlink",
                        "target": "${:bitstream}.jlink"
                    },
                    "bitstream_jlink_log": {
                        "mode": "stdout",
                        "target": "${:bitstream}.jlink.log"
                    }
                },
                "inputs": {
                    "#1": "${:bitstream}",
                    "#2": "${:bitstream}.jlink",
                    "#3": "${:iomux_jlink}"
                }
            }
        },
        "bitstream_openocd": {
            "params": {
                "stage_name": "bitstream_openocd",
                "script": "symbiflow_write_openocd",
                "outputs": {
                    "bitstream_openocd": {
                        "mode": "file",
                        "file": "${:bitstream}.openocd",
                        "target": "${:bitstream}.openocd"
                    },
                    "bitstream_openocd_log": {
                        "mode": "stdout",
                        "target": "${:bitstream}.openocd.log"
                    }
                },
                "inputs": {
                    "#1": "${:bitstream}",
                    "#2": "${:bitstream}.openocd",
                    "#3": "${:iomux_openocd}"
                }
            }
        },
        "bitstream_binary": {
            "params": {
                "stage_name": "bitstream_binary",
                "script": "symbiflow_write_binary",
                "outputs": {
                    "bitstream_binary": {
                        "mode": "file",
                        "file": "${:bitstream}.bin",
                        "target": "${:bitstream}.bin"
                    },
                    "bitstream_binary_log": {
                        "mode": "stdout",
                        "target": "${:bitstream}.bin.log"
                    }
                },
                "inputs": {
                    "#1": "${:bitstream}",
                    "#2": "${:bitstream}.bin",
                    "#3": "${:iomux_binary}"
                }
            }
        }
    }
}
